%% -----------------------------------------------------------------
SMALL STUFF:

* cosmetic: unify underscores and capitalization in naming!

* Clean up global variables

* move contents of main subfolder into main folder ?

* add a firstFigNum parameter, and display figures starting with this number (useful for comparing results with two different sets of parameters).

* AmplitudeThredholdGUI:
  - change timescales to msec, plot 0-20 msec ?
  - how to exit?
  - font sizes 

* Fix display stuff in whitening:
  - fig3: histogram of windowed 2-norm, with threshold 
  - fig4: plot ACF of noise regions
  - fig5: display cross-channel correlations, but only if more than one channel!
  - fig6: noise distribution, compared with Gaussian and Laplacian
  - fonts/line thicknesses

* display in clustering: time in msec, legend

* thresholds should be expressed relative to MEAN amplitudes over electrodes, not SUM.

* Consistency of thresholding test for spikes/noise: why are these all different?
   - whitening section uses cross-channel norm for determining noise chunks
   - clustering uses joint channel-time norm for grabbing spike segments
   - CBP chunking done using yet another windowed norm
  EITHER explain why their different (and use separate parameters), or make them the same! 

* threshold for choosing snippets for clustering is currently 4*std(data_magnitude) ???
  where did this come from?

* num_waveforms should be a general parameter, not in clustering

* filtering.pad should be set to max of order and waveform_len

* visualization of CBP spikes in PC-space alongside clustering

* Set default filtering to frequency ranges of typical spike waveforms.  

* show multiple PC views (1 vs 2, 2 vs 3, 1 vs 3) of clustering results

%% -----------------------------------------------------------------
BIG CHANGES:

* Data file should include a t0 (time of initial sample) and all times should be relative to that
  This requires computing/correcting filtering lags

* CBP Priors on firing rates (currently hard-coded) should be set based on clustering results

* Handle noise distributions with other pnorms (stretched exponentials) 
   [NOTE: easy with cvx package, but hard to do with ecos]

* Allow user to increase number of cells, and choose a starting waveform by clicking on the PC plot?

%% -----------------------------------------------------------------
MAJOR MODIFICATIONS:

* Embed final thresholding step into iterations, using an operator-splitting method like ADMM

* Automatic thredhold settings based on: noise level, prior on firing rate, minimum amplitude (relative to typical amplitude), and relative cost of Misses vs. False Alarms.
